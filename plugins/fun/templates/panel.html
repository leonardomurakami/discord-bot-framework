{% extends "plugin_base.html" %}

{% block extra_styles %}
/* Fun plugin specific styling - extends the base template */
.game-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.75rem;
}

.game-card {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.game-card p {
    color: var(--text-secondary);
    margin: -0.25rem 0 0.5rem 0;
}

.game-card form {
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
    align-items: stretch;
}

.game-card form .input-group {
    text-align: left;
}

.game-card .card-actions {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    align-items: center;
}

.game-card .card-actions .btn,
.game-card > .card-actions .btn {
    width: min(240px, 100%);
}

.game-card .card-actions .htmx-indicator {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.game-card .result {
    display: none;
    margin-top: 0.75rem;
    padding: 1rem 1.1rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: calc(var(--card-radius) - 6px);
    text-align: left;
    color: var(--text-primary);
}

.game-card .result.show {
    display: block;
    animation: fadeInUp 0.25s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(6px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
{% endblock %}

{% block content %}
<div class="game-grid">
    <div class="game-card">
        <div class="game-title">ðŸŽ² Dice Roller</div>
        <p>Roll dice using standard notation (e.g., 2d6, 3d20)</p>
        <form hx-post="/plugin/fun/api/roll" hx-target="#roll-result" hx-indicator="#roll-loading">
            <div class="input-group">
                <label for="dice">Dice Notation:</label>
                <input type="text" id="dice" name="dice" value="1d6" placeholder="e.g., 2d6, 3d20">
            </div>
            <div class="card-actions">
                <button type="submit" class="btn">ðŸŽ² Roll Dice</button>
                <span id="roll-loading" class="htmx-indicator">Rolling...</span>
            </div>
        </form>
        <div id="roll-result" class="result"></div>
    </div>

    <div class="game-card">
        <div class="game-title">ðŸª™ Coin Flip</div>
        <p>Flip a virtual coin and see if it lands on heads or tails</p>
        <div class="card-actions">
            <button class="btn" hx-post="/plugin/fun/api/coinflip" hx-target="#coinflip-result" hx-indicator="#coinflip-loading">
                ðŸª™ Flip Coin
            </button>
            <span id="coinflip-loading" class="htmx-indicator">Flipping...</span>
        </div>
        <div id="coinflip-result" class="result"></div>
    </div>

    <div class="game-card">
        <div class="game-title">ðŸŽ± Magic 8-Ball</div>
        <p>Ask the magic 8-ball a question and get a mystical answer</p>
        <form hx-post="/plugin/fun/api/8ball" hx-target="#eightball-result" hx-indicator="#eightball-loading">
            <div class="input-group">
                <label for="question">Your Question:</label>
                <input type="text" id="question" name="question" placeholder="Ask anything...">
            </div>
            <div class="card-actions">
                <button type="submit" class="btn">ðŸŽ± Ask 8-Ball</button>
                <span id="eightball-loading" class="htmx-indicator">Consulting the spirits...</span>
            </div>
        </form>
        <div id="eightball-result" class="result"></div>
    </div>

    <div class="game-card">
        <div class="game-title">ðŸŽ² Random Number</div>
        <p>Generate a random number within your specified range</p>
        <form hx-post="/plugin/fun/api/random" hx-target="#random-result" hx-indicator="#random-loading">
            <div class="input-group">
                <label for="min">Minimum:</label>
                <input type="number" id="min" name="min" value="1">
            </div>
            <div class="input-group">
                <label for="max">Maximum:</label>
                <input type="number" id="max" name="max" value="100">
            </div>
            <div class="card-actions">
                <button type="submit" class="btn">ðŸŽ¯ Generate Number</button>
                <span id="random-loading" class="htmx-indicator">Generating...</span>
            </div>
        </form>
        <div id="random-result" class="result"></div>
    </div>

    <div class="game-card">
        <div class="game-title">ðŸ˜‚ Random Joke</div>
        <p>Get a random joke to brighten your day</p>
        <div class="card-actions">
            <button class="btn" hx-post="/plugin/fun/api/joke" hx-target="#joke-result" hx-indicator="#joke-loading">
                ðŸ˜‚ Tell me a joke!
            </button>
            <span id="joke-loading" class="htmx-indicator">Finding a good one...</span>
        </div>
        <div id="joke-result" class="result"></div>
    </div>

    <div class="game-card">
        <div class="game-title">ðŸ’­ Inspirational Quote</div>
        <p>Get motivated with an inspirational quote</p>
        <div class="card-actions">
            <button class="btn btn-success" hx-post="/plugin/fun/api/quote" hx-target="#quote-result" hx-indicator="#quote-loading">
                âœ¨ Inspire me!
            </button>
            <span id="quote-loading" class="htmx-indicator">Finding wisdom...</span>
        </div>
        <div id="quote-result" class="result"></div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Auto-show result divs when HTMX updates them
document.body.addEventListener('htmx:afterSwap', function(event) {
    if (event.detail.target.classList.contains('result')) {
        event.detail.target.style.display = 'block';
        event.detail.target.classList.add('show');
    }
});

// Clear previous results when starting new requests
document.body.addEventListener('htmx:beforeRequest', function(event) {
    const targetSelector = event.detail.elt.getAttribute('hx-target');
    if (targetSelector) {
        const target = document.querySelector(targetSelector);
        if (target && target.classList.contains('result')) {
            target.style.display = 'none';
            target.classList.remove('show');
            target.innerHTML = '';
        }
    }
});

console.log('Fun & Games panel loaded with plugin-local templates!');
</script>
{% endblock %}
